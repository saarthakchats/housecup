<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>{{ house.mascot }}</title>
		<link href="https://fonts.googleapis.com/css?family=Titillium+Web&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	</head>
	<body>
		<h1 align=center class="display-4 pt-4">{{ house.motto }}</h1>
		<canvas id="myChart"></canvas>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
		<script type="text/javascript">
			Chart.pluginService.register({
				beforeDraw: function (chart) {
					if (chart.config.options.elements.center) {
						//Get ctx from string
						var ctx = chart.chart.ctx;
						
						//Get options from the center object in options
						var centerConfig = chart.config.options.elements.center;
						var fontStyle = centerConfig.fontStyle || 'Arial';
						var txt = centerConfig.text;
						var color = centerConfig.color || '#000';
						var sidePadding = centerConfig.sidePadding || 20;
						var sidePaddingCalculated = (sidePadding/100) * (chart.innerRadius * 2)
						//Start with a base font of 30px
						ctx.font = "30px " + fontStyle;
						
						//Get the width of the string and also the width of the element minus 10 to give it 5px side padding
						var stringWidth = ctx.measureText(txt).width;
						var elementWidth = (chart.innerRadius * 2) - sidePaddingCalculated;

						// Find out how much the font can grow in width.
						var widthRatio = elementWidth / stringWidth;
						var newFontSize = Math.floor(30 * widthRatio);
						var elementHeight = (chart.innerRadius * 2);

						// Pick a new font size so it will not be larger than the height of label.
						var fontSizeToUse = Math.min(newFontSize, elementHeight);

						//Set font settings to draw it correctly.
						ctx.textAlign = 'center';
						ctx.textBaseline = 'middle';
						var centerX = ((chart.chartArea.left + chart.chartArea.right) / 2);
						var centerY = ((chart.chartArea.top + chart.chartArea.bottom) / 2);
						ctx.font = fontSizeToUse+"px " + fontStyle;
						ctx.fillStyle = color;
						
						//Draw text in center
						ctx.fillText(txt, centerX, centerY);
					}
				}
			});
			var ctx = document.getElementById('myChart').getContext('2d');
			var myDoughnutChart = new Chart(ctx, {
				type: 'doughnut',
				data: {
					datasets: [{
						data: [{{house.sports}}, {{house.academics}}, {{house.competitions}}, {{house.achievements}}, {{house.misc}}],
						backgroundColor: ['#6050DC', '#D52DB7', '#47B39C', '#FF6B45', '#FFAB05']
					}],
					// These labels appear in the legend and in the tooltips when hovering different arcs
					labels: [
						'Sports',
						'Academics',
						'Competitions',
						'Achievements',
						'Miscellaneous'
					]
				},
				options: {
					cutoutPercentage: 40,
					title: {
						display: true,
						text: '{{ house.name }} House',
						position: 'top',
						fontStyle: 'bold',
						fontSize: 33,
						fontColor: '#{{house.colour}}',
						padding: 10
					},
					animation: {
						duration: 2500,
						easing: 'easeInQuart',
					},
					legend: {
						display: true,
						position: 'bottom',
						labels: {
							padding: 10
						}
					},
					elements: {
						center: {
							text: '{{house.points}}',
		          color: '#{{house.colour}}', 
		          sidePadding: 30
						}
					}
				}
			});
		</script>
	</body>
</html>